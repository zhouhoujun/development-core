"use strict";function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,t,r){return t&&e(n.prototype,t),r&&e(n,r),n}}(),coregulp=require("gulp"),chalk=require("chalk"),_=require("lodash"),PipeTask=function(){function e(n){_classCallCheck(this,e),this.decorator=n||{}}return _createClass(e,[{key:"pipes",value:function(e,n,t){var r=e.option,o=r.loader;return o&&_.isFunction(o.pipes)?_.isFunction(o.pipes)?o.pipes(e,r,t):_.filter(o.pipes,function(e){return _.isFunction(e)||!e.name||e.name&&e.name===n.name}):[]}},{key:"output",value:function(e,n,t){var r=e.option,o=r.loader;if(o&&!_.isString(o)&&!_.isArray(o)){if(o.output)return _.isFunction(o.output)?o.output(e,r,t):o.output;if(null===o.output)return[function(e){return e}]}return[function(r){return r.pipe(t.dest(e.getDist(n)))}]}},{key:"getOption",value:function(e){return e.option}},{key:"sourceStream",value:function(e,n,t){return t.src(e.getSrc(n,this.decorator))}},{key:"setup",value:function(e,n){var t=this;n=n||coregulp;var r=this.getOption(e),o=e.subTaskName(r,this.name);return console.log("register "+this.name+" task:",chalk.cyan(o)),n.task(o,function(){return Promise.resolve(t.sourceStream(e,r,n)).then(function(o){return Promise.all(_.map(t.pipes(e,r,n),function(t){return _.isFunction(t)?t(e,r,n):t.toTransform(e,r,n)})).then(function(e){var n=e.length;return e=_.orderBy(e,function(e){return _.isArray(e)?n:_.isNumber(e.order)?e.order:n}),_.each(e,function(e){o=o.pipe(e)}),o})}).then(function(o){var i=t.output(e,r,n);return Promise.all(_.map(i,function(t){return Promise.resolve(_.isFunction(t)?t(o,e,r,n):t).then(function(e){return new Promise(function(n,t){e.once("end",function(){n(e)}).once("error",t)})})}))}).catch(function(e){console.log(chalk.red(e)),process.exit(0)})}),this.decorator.taskName=o,o}}]),e}();exports.PipeTask=PipeTask;
//# sourceMappingURL=sourcemaps/PipeTask.js.map
