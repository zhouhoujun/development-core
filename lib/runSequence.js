"use strict";function toSequence(e,r){var n=[];e=_.filter(e,function(e){return e});var t=e.length;return e=_.orderBy(e,function(e){return e?_.isString(e)?t:_.isArray(e)?t:e.order:t}),_.each(e,function(e){e&&(_.isString(e)?n.push(e):_.isArray(e)?n.push(_.flatten(toSequence(e,r))):e.name&&(e.oper?(e.oper&r)>0&&n.push(e.name):n.push(e.name)))}),n}function runSequence(e,r){var n=Promise.resolve();return r&&r.length>0&&_.each(r,function(r){n=n.then(function(){var n=null,t=null;return new Promise(function(u,o){var c={};_.each(_.isArray(r)?r:[r],function(e){c[e]=!1}),n=function(e){process.exit(e),console.error(chalk.red(e)),o(e)},t=function(e){c[e.task]=!0,_.some(_.values(c),function(e){return!e})||u()},e.on("task_stop",t).on("task_err",n),e.start(r)}).then(function(){e.removeListener&&(e.removeListener("task_stop",t),e.removeListener("task_err",n))}).catch(function(r){e.removeListener&&(e.removeListener("task_stop",t),e.removeListener("task_err",n))})})}),n.catch(function(e){console.error(chalk.red(e))})}function runTaskSequence(e,r,n){var t=toSequence(_.map(r,function(r){return r(e,n)}),n.oper);return runSequence(e,t)}var _=require("lodash"),chalk=require("chalk");exports.toSequence=toSequence,exports.runSequence=runSequence,exports.runTaskSequence=runTaskSequence;
//# sourceMappingURL=sourcemaps/runSequence.js.map
