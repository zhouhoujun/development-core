"use strict";function task(e){if(_.isFunction(e))return e.__task={},e;var n=function(){var n=e;return{v:function(e){return e.__task=n||{},e}}}();return"object"===("undefined"==typeof n?"undefined":_typeof(n))?n.v:void 0}function dynamicTask(e){if(e&&_.isFunction(e))return e.__dynamictask={},e;var n=function(){var n=e;return{v:function(e){return e.__dynamictask=n||{},e}}}();return"object"===("undefined"==typeof n?"undefined":_typeof(n))?n.v:void 0}function findTaskset(e,n,i,t){if(n)if(_.isFunction(n)){if(n.__task){var r=n.__task;if(r=_.isBoolean(r)?{}:r,!utils_1.matchCompare(r,i,t))return;if(e.has(n))return;var s=new n(r);s.setInfo&&s.setInfo(r),e.set(n,s)}else if(n.__dynamictask){var a=function(){var r=n.__dynamictask;if(!utils_1.matchCompare(r,i,t))return{v:void 0};if(e.has(n))return{v:void 0};var s=_.map((new n).tasks(),function(e){return e=_.extend(_.clone(r),e)});e.set(n,generateTask_1.generateTask(s,i,t))}();if("object"===("undefined"==typeof a?"undefined":_typeof(a)))return a.v}}else _.isArray(n)?_.each(n,function(n){findTaskset(e,n,i,t)}):_.each(_.keys(n),function(r){r&&n[r]&&!/^[0-9]+$/.test(r)&&(console.log(chalk.grey("find task from :"),chalk.cyan(r)),findTaskset(e,n[r],i,t))})}function findTaskMap(e,n,i,t){t=t||new Map,findTaskset(t,e,n,i);var r=[];return t.forEach(function(e){_.isArray(e)?r=r.concat(e):r.push(e)}),r}function findTasks(e,n,i){return findTaskMap(e,n,i)}function taskdefine(e){if(_.isFunction(e))return e.__task_context=!0,e;var n=function(){var n=e;return{v:function(e){return e.__task_context=n||!0,e}}}();return"object"===("undefined"==typeof n?"undefined":_typeof(n))?n.v:void 0}function findTaskDefines(e){var n=[];if(!e)return n;if(_.isFunction(e)){if(e.__task_context){var i=new e;i.getContext||(i=taskDefine2Context(i)),n.push(i)}}else _.isArray(e)?_.each(e,function(e){n.concat(findTaskDefines(e))}):_.each(_.keys(e),function(i){i&&e[i]&&!/^[0-9]+$/.test(i)&&(console.log(chalk.grey("find task define from :"),chalk.cyan(i)),n=n.concat(findTaskDefines(e[i])))});return n}function findTaskDefine(e){var n=void 0;if(!e)return null;if(_.isFunction(e)){if(e.__task_context){var i=new e;n=i.getContext?i:taskDefine2Context(i)}}else _.isArray(e)?_.each(e,function(e){return!n&&(n=findTaskDefine(e),!0)}):_.each(_.keys(e),function(i){return!n&&(!(i&&e[i]&&!/^[0-9]+$/.test(i))||(console.log(chalk.grey("find task define from :"),chalk.cyan(i)),n=findTaskDefine(e[i]),!0))});return n}function findTaskDefineInModule(e){var n=void 0;try{n=findTaskDefine(_.isString(e)?require(e):e)}catch(e){return Promise.reject(e)}return n?Promise.resolve(n):(console.log(chalk.yellow("can not found task define in module.")),Promise.resolve(null))}function findTasksInModule(e,n,i){var t=void 0;try{t=_.isString(e)?findTasks(require(e),n,i):findTasks(e,n,i)}catch(e){return Promise.reject(e)}return Promise.resolve(t)}function findTaskDefineInDir(e){return Promise.race(_.map(_.isArray(e)?e:[e],function(e){return new Promise(function(n,i){if(fs_1.existsSync(e)){var t=requireDir(e,{duplicates:!0,camelcase:!0,recurse:!0});if(t){var r=findTaskDefine(t);r&&n(r)}}})}))}function findTasksInDir(e,n,i){var t=new Map;return Promise.all(_.map(_.isArray(e)?e:[e],function(e){console.log(chalk.grey("begin load task from dir"),chalk.cyan(e));try{var r=requireDir(e,{duplicates:!0,camelcase:!0,recurse:!0});return Promise.resolve(findTaskMap(r,n,i,t))}catch(e){return Promise.reject(e)}})).then(function(e){return _.flatten(e)})}function taskDefine2Context(e){var n=_.extend({},e);return n.getContext=function(n){return bindingConfig_1.bindingConfig(e.loadConfig(n.option,n.env))},n.tasks=e.loadTasks?function(n){return e.loadTasks(n)}:null,n}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};require("reflect-metadata");var _=require("lodash"),chalk=require("chalk"),generateTask_1=require("./generateTask"),bindingConfig_1=require("./bindingConfig"),utils_1=require("./utils"),fs_1=require("fs"),requireDir=require("require-dir");exports.task=task,exports.dynamicTask=dynamicTask,exports.findTasks=findTasks,exports.taskdefine=taskdefine,exports.findTaskDefines=findTaskDefines,exports.findTaskDefine=findTaskDefine,exports.findTaskDefineInModule=findTaskDefineInModule,exports.findTasksInModule=findTasksInModule,exports.findTaskDefineInDir=findTaskDefineInDir,exports.findTasksInDir=findTasksInDir,exports.taskDefine2Context=taskDefine2Context;
//# sourceMappingURL=sourcemaps/decorator.js.map
