"use strict";function task(e){return function(n){return n.__task=e||{},n}}function findTasks(e){var n=[];if(!e)return n;if(_.isFunction(e)){if(e.__task){var i=new e;i.decorator=e.__task,n.push(i)}}else _.isArray(e)?_.each(e,function(e){n.concat(findTasks(e))}):_.each(_.keys(e),function(i){i&&e[i]&&!/^[0-9]+$/.test(i)&&(console.log(chalk.grey("find task from :"),chalk.cyan(i)),n=n.concat(findTasks(e[i])))});return n}function taskdefine(){return function(e){return e.__taskdefine=!0,e}}function findTaskDefines(e){var n=[];return e?(_.isFunction(e)?e.__taskdefine&&n.push(new e):_.isArray(e)?_.each(e,function(e){n.concat(findTaskDefines(e))}):_.each(_.keys(e),function(i){i&&e[i]&&!/^[0-9]+$/.test(i)&&(console.log(chalk.grey("find task define from :"),chalk.cyan(i)),n=n.concat(findTaskDefines(e[i])))}),n):n}function findTaskDefine(e){var n=void 0;return e?(_.isFunction(e)?e.__taskdefine&&(n=new e):_.isArray(e)?_.each(e,function(e){return!n&&(n=findTaskDefine(e),!0)}):_.each(_.keys(e),function(i){return!n&&(!(i&&e[i]&&!/^[0-9]+$/.test(i))||(console.log(chalk.grey("find task define from :"),chalk.cyan(i)),n=findTaskDefine(e[i]),!0))}),n):null}function findTaskDefineInModule(e){var n=void 0;try{n=findTaskDefine(_.isString(e)?require(e):e)}catch(e){return Promise.reject(e)}return n?Promise.resolve(n):Promise.reject("can not found task define.")}function findTasksInModule(e){var n=void 0;try{n=findTasks(_.isString(e)?require(e):e)}catch(e){return Promise.reject(e)}return Promise.resolve(n)}function findTaskDefineInDir(e){return Promise.race(_.map(_.isArray(e)?e:[e],function(e){return new Promise(function(n,i){if(fs_1.existsSync(e)){var r=requireDir(e);if(r){var s=findTaskDefine(r);s&&n(s)}}})}))}function findTasksInDir(e){return Promise.all(_.map(_.isArray(e)?e:[e],function(e){console.log(chalk.grey("begin load task from dir"),chalk.cyan(e));try{var n=requireDir(e,{recurse:!0});return Promise.resolve(findTasks(n))}catch(e){return Promise.reject(e)}})).then(function(e){return _.flatten(e)})}require("reflect-metadata");var _=require("lodash"),chalk=require("chalk"),fs_1=require("fs"),requireDir=require("require-dir");exports.task=task,exports.findTasks=findTasks,exports.taskdefine=taskdefine,exports.findTaskDefines=findTaskDefines,exports.findTaskDefine=findTaskDefine,exports.findTaskDefineInModule=findTaskDefineInModule,exports.findTasksInModule=findTasksInModule,exports.findTaskDefineInDir=findTaskDefineInDir,exports.findTasksInDir=findTasksInDir;
//# sourceMappingURL=sourcemaps/decorator.js.map
