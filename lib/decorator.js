"use strict";function task(e){if(_.isFunction(e))return e.__task={},e;var n=function(){var n=e;return{v:function(e){return e.__task=n||{},e}}}();return"object"===("undefined"==typeof n?"undefined":_typeof(n))?n.v:void 0}function dynamicTask(e){if(e&&_.isFunction(e))return e.__dynamictask=!0,e;var n=function(){var n=e;return{v:function(e){return e.__dynamictask=n||!0,e}}}();return"object"===("undefined"==typeof n?"undefined":_typeof(n))?n.v:void 0}function findTasks(e,n){var r=[];if(!e)return r;if(_.isFunction(e)){if(e.__task){var i=e.__task;if(n&&n.oper&&i.oper&&(i.oper&n.oper)<=0)return r;if(!utils_1.matchTaskGroup(i,n))return r;if(i.watch){if(!n||!n.watch)return r;if(i.watch!==n.watch)return r}var t=new e;t.decorator=i,r.push(t)}else if(e.__dynamictask){var a=function(){var i=e.__dynamictask;if(n&&n.oper&&i.oper&&(i.oper&n.oper)<=0)return{v:r};if(!utils_1.matchTaskGroup(i,n))return{v:r};if(i.watch){if(!n||!n.watch)return{v:r};if(i.watch!==n.watch)return{v:r}}var t=_.map((new e).tasks(),function(e){return e.group=e.group||i.group,e});r=r.concat(generateTask_1.generateTask(t,n))}();if("object"===("undefined"==typeof a?"undefined":_typeof(a)))return a.v}}else _.isArray(e)?_.each(e,function(e){r.concat(findTasks(e,n))}):_.each(_.keys(e),function(i){i&&e[i]&&!/^[0-9]+$/.test(i)&&(console.log(chalk.grey("find task from :"),chalk.cyan(i)),r=r.concat(findTasks(e[i],n)))});return r}function taskdefine(e){if(_.isFunction(e))return e.__taskdefine=!0,e;var n=function(){var n=e;return{v:function(e){return e.__taskdefine=n||!0,e}}}();return"object"===("undefined"==typeof n?"undefined":_typeof(n))?n.v:void 0}function findTaskDefines(e){var n=[];return e?(_.isFunction(e)?e.__taskdefine&&n.push(new e):_.isArray(e)?_.each(e,function(e){n.concat(findTaskDefines(e))}):_.each(_.keys(e),function(r){r&&e[r]&&!/^[0-9]+$/.test(r)&&(console.log(chalk.grey("find task define from :"),chalk.cyan(r)),n=n.concat(findTaskDefines(e[r])))}),n):n}function findTaskDefine(e){var n=void 0;return e?(_.isFunction(e)?e.__taskdefine&&(n=new e):_.isArray(e)?_.each(e,function(e){return!n&&(n=findTaskDefine(e),!0)}):_.each(_.keys(e),function(r){return!n&&(!(r&&e[r]&&!/^[0-9]+$/.test(r))||(console.log(chalk.grey("find task define from :"),chalk.cyan(r)),n=findTaskDefine(e[r]),!0))}),n):null}function findTaskDefineInModule(e){var n=void 0;try{n=findTaskDefine(_.isString(e)?require(e):e)}catch(e){return Promise.reject(e)}return n?Promise.resolve(n):Promise.reject("can not found task define.")}function findTasksInModule(e,n){var r=void 0;try{r=_.isString(e)?findTasks(require(e),n):findTasks(e,n)}catch(e){return Promise.reject(e)}return Promise.resolve(r)}function findTaskDefineInDir(e){return Promise.race(_.map(_.isArray(e)?e:[e],function(e){return new Promise(function(n,r){if(fs_1.existsSync(e)){var i=requireDir(e);if(i){var t=findTaskDefine(i);t&&n(t)}}})}))}function findTasksInDir(e,n){return Promise.all(_.map(_.isArray(e)?e:[e],function(e){console.log(chalk.grey("begin load task from dir"),chalk.cyan(e));try{var r=requireDir(e,{recurse:!0});return Promise.resolve(findTasks(r,n))}catch(e){return Promise.reject(e)}})).then(function(e){return _.flatten(e)})}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};require("reflect-metadata");var _=require("lodash"),chalk=require("chalk"),generateTask_1=require("./generateTask"),utils_1=require("./utils"),fs_1=require("fs"),requireDir=require("require-dir");exports.task=task,exports.dynamicTask=dynamicTask,exports.findTasks=findTasks,exports.taskdefine=taskdefine,exports.findTaskDefines=findTaskDefines,exports.findTaskDefine=findTaskDefine,exports.findTaskDefineInModule=findTaskDefineInModule,exports.findTasksInModule=findTasksInModule,exports.findTaskDefineInDir=findTaskDefineInDir,exports.findTasksInDir=findTasksInDir;
//# sourceMappingURL=sourcemaps/decorator.js.map
