{"version":3,"sources":["generateTask.ts"],"names":["generateTask","ctx","tasks","match","taskseq","_","each","isArray","dt","oper","to","Operation_1","Operation","default","watchTasks","watch","match_1","matchCompare","autoWatch","push","createTask","createWatchTask","shell","ShellTask_1","ShellTask","execFiles","ExecFileTask_1","ExecFileTask","isFunction","task","createCustomTask","createPipesTask","DynamicTask_1","DynamicTask","name","order","group","assert","DynamicWatchTask_1","DynamicWatchTask","DynamicPipeTask_1","DynamicPipeTask","require","exports"],"mappings":"YAuBA,SAAAA,cAA6BC,EAAmBC,EAAkDC,GAC9F,GAAIC,KAkBJ,OAjBAC,GAAEC,KAAKD,EAAEE,QAAQL,GAASA,GAASA,GAAQ,SAAAM,GACvCA,EAAGC,KAAOD,EAAGC,KAAOR,EAAIS,GAAGF,EAAGC,MAAQE,YAAAC,UAAUC,QAC5CL,EAAGM,aACHN,EAAGC,KAAOD,EAAGC,KAAOE,YAAAC,UAAUG,OAG7BC,QAAAC,aAAahB,EAAKO,EAAIL,MAIvBK,EAAGO,OAAWP,EAAGC,KAAOE,YAAAC,UAAUG,QAClCP,EAAGC,KAAOD,EAAGC,KAAOE,YAAAC,UAAUM,WAElCd,EAAQe,KAAKC,WAAWnB,EAAKO,OAI1BJ,EAUX,QAAAgB,YAAoBnB,EAAmBO,GAenC,MAbIP,GAAIS,GAAGF,EAAGC,MAAQE,YAAAC,UAAUG,MACrBM,gBAAgBb,GAChBA,EAAGc,MACH,GAAIC,aAAAC,UAAUhB,EAAIA,EAAGc,OACrBd,EAAGiB,UACH,GAAIC,gBAAAC,aAAanB,EAAIA,EAAGiB,WACxBpB,EAAEuB,WAAWpB,EAAGqB,MAEhBC,iBAAiBtB,GAGjBuB,gBAAgBvB,GAY/B,QAAAsB,kBAA0BtB,GACtB,MAAO,IAAIwB,eAAAC,aAAcC,KAAM1B,EAAG0B,KAAMC,MAAO3B,EAAG2B,MAAO1B,KAAMD,EAAGC,KAAM2B,MAAO5B,EAAG4B,MAAOC,OAAQ7B,GAAMA,GAW3G,QAAAa,iBAAyBb,GACrB,MAAO,IAAI8B,oBAAAC,kBAAmBL,KAAM1B,EAAG0B,KAAMC,MAAO3B,EAAG2B,MAAO1B,KAAMD,EAAGC,KAAM2B,MAAO5B,EAAG4B,MAAOC,OAAQ7B,GAAMA,GAUhH,QAAAuB,iBAAyBvB,GACrB,MAAO,IAAIgC,mBAAAC,gBAAgBjC,yDArG/B,IAAAH,GAAAqC,QAAA,UACA1B,QAAA0B,QAAA,iBACAV,cAAAU,QAAA,uBACAJ,mBAAAI,QAAA,4BACAF,kBAAAE,QAAA,2BACAnB,YAAAmB,QAAA,qBACAhB,eAAAgB,QAAA,wBAIA/B,YAAA+B,QAAA,cAaAC,SAAA3C,aAAAA","file":"../generateTask.js","sourcesContent":["import * as _ from 'lodash';\r\nimport { matchCompare } from './utils/match';\r\nimport { DynamicTask } from './tasks/DynamicTask';\r\nimport { DynamicWatchTask } from './tasks/DynamicWatchTask';\r\nimport { DynamicPipeTask } from './tasks/DynamicPipeTask';\r\nimport { ShellTask } from './tasks/ShellTask';\r\nimport { ExecFileTask } from './tasks/ExecFileTask';\r\nimport { ITaskContext } from './ITaskContext';\r\nimport { IDynamicTaskOption } from './IDynamicTaskOption';\r\nimport { ITask, ITaskInfo } from './ITask';\r\nimport { Operation } from './Operation';\r\n\r\n\r\n\r\n/**\r\n * dynamic build tasks.\r\n *\r\n * @export\r\n * @param {ITaskContext} ctx\r\n * @param {(IDynamicTaskOption | IDynamicTaskOption[])} tasks\r\n * @param {ITaskInfo} [match]\r\n * @returns {ITask[]}\r\n */\r\nexport function generateTask(ctx: ITaskContext, tasks: IDynamicTaskOption | IDynamicTaskOption[], match?: ITaskInfo): ITask[] {\r\n    let taskseq: ITask[] = [];\r\n    _.each(_.isArray(tasks) ? tasks : [tasks], dt => {\r\n        dt.oper = dt.oper ? ctx.to(dt.oper) : Operation.default;\r\n        if (dt.watchTasks) {\r\n            dt.oper = dt.oper | Operation.watch;\r\n        }\r\n\r\n        if (!matchCompare(ctx, dt, match)) {\r\n            return;\r\n        }\r\n\r\n        if (dt.watch && !(dt.oper & Operation.watch)) {\r\n            dt.oper = dt.oper | Operation.autoWatch;\r\n        }\r\n        taskseq.push(createTask(ctx, dt));\r\n\r\n    });\r\n\r\n    return taskseq;\r\n}\r\n\r\n/**\r\n * create task by dynamic option.\r\n *\r\n * @param {ITaskContext} ctx\r\n * @param {IDynamicTaskOption} dt\r\n * @returns {ITask}\r\n */\r\nfunction createTask(ctx: ITaskContext, dt: IDynamicTaskOption): ITask {\r\n    let task: ITask;\r\n    if (ctx.to(dt.oper) & Operation.watch) {\r\n        task = createWatchTask(dt);\r\n    } else if (dt.shell) {\r\n        task = new ShellTask(dt, dt.shell);\r\n    } else if (dt.execFiles) {\r\n        task = new ExecFileTask(dt, dt.execFiles);\r\n    } else if (_.isFunction(dt.task)) {\r\n        // custom task\r\n        task = createCustomTask(dt);\r\n    } else {\r\n        // pipe stream task.\r\n        task = createPipesTask(dt);\r\n    }\r\n    return task;\r\n}\r\n\r\n\r\n/**\r\n * create custom task.\r\n *\r\n * @param {IDynamicTaskOption} dt\r\n * @returns {ITask}\r\n */\r\nfunction createCustomTask(dt: IDynamicTaskOption): ITask {\r\n    return new DynamicTask({ name: dt.name, order: dt.order, oper: dt.oper, group: dt.group, assert: dt }, dt);\r\n}\r\n\r\n\r\n/**\r\n * create dynamic watch task.\r\n *\r\n * @export\r\n * @param {IDynamicTaskOption} dt\r\n * @returns {ITask}\r\n */\r\nfunction createWatchTask(dt: IDynamicTaskOption): ITask {\r\n    return new DynamicWatchTask({ name: dt.name, order: dt.order, oper: dt.oper, group: dt.group, assert: dt }, dt);\r\n}\r\n\r\n/**\r\n * create pipe task.\r\n *\r\n * @export\r\n * @param {IDynamicTaskOption} dt\r\n * @returns {ITask}\r\n */\r\nfunction createPipesTask(dt: IDynamicTaskOption): ITask {\r\n    return new DynamicPipeTask(dt);\r\n}\r\n"]}