{"version":3,"sources":["utils.js","utils.ts"],"names":["files","directory","express","res","fn","_","each","fs_1","readdirSync","fname","filePn","fst","lstatSync","isDirectory","concat","push","taskSourceVal","src","oper","isFunction","taskStringVal","name","contains","arr1","arr2","some","arr2Item","indexOf","convertOper","tinfo","def","arguments","length","undefined","TaskConfig_1","Operation","default","watch","e2e","test","convertMatchOper","match","release","build","deploy","matchOper","eq","serve","matchTaskGroup","group","isString","isArray","require","exports"],"mappings":"AAAA,YCWA,SAAAA,OAAsBC,EAAmBC,GACrC,GAAIC,KAaJ,OAZAD,GAAUA,GAAY,SAACE,GAAD,OAAQ,GAC9BC,EAAEC,KAAKC,KAAAC,YAAYP,GAAY,SAAAQ,GAC3B,GAAIC,GAAST,EAAY,IAAMQ,EAC3BE,EAAMJ,KAAAK,UAAUF,EACfC,GAAIE,cAKLV,EAAMA,EAAIW,OAAOd,MAAMU,EAAQR,IAJ3BA,EAAQQ,IACRP,EAAIY,KAAKL,KAMdP,EAGX,QAAAa,eAA8BC,EAAiBC,GAC3C,MAAOb,GAAEc,WAAWF,GAAOA,EAAIC,GAASD,GAAO,GAGnD,QAAAG,eAA8BC,EAAkBH,GAC5C,MAAOb,GAAEc,WAAWE,GAAQA,EAAKH,GAASG,GAAQ,GAItD,QAAAC,UAAkBC,EAAgBC,GAC9B,MAAOA,GAAKC,KAAK,SAAAC,GAAA,MAAYH,GAAKI,QAAQD,IAAa,IAY3D,QAAAE,aAA4BC,GAAyC,GAAvBC,GAAuBC,UAAAC,OAAA,GAAAC,SAAAF,UAAA,GAAAA,UAAA,GAAjBG,aAAAC,UAAUC,OAa1D,OAZAP,GAAQA,MACJA,EAAMQ,QACNR,EAAMX,MAAQW,EAAMX,MAAQY,GAAOI,aAAAC,UAAUE,OAE7CR,EAAMS,MACNT,EAAMX,MAAQW,EAAMX,MAAQY,GAAOI,aAAAC,UAAUG,KAE7CT,EAAMU,OACNV,EAAMX,MAAQW,EAAMX,MAAQY,GAAOI,aAAAC,UAAUI,MAGjDV,EAAMX,KAAOW,EAAMX,MAAQY,EACpBD,EAEX,QAAAW,kBAA0BC,GActB,OAbKA,EAAMvB,KAAOgB,aAAAC,UAAUI,MAAQ,IAAME,EAAMvB,KAAOgB,aAAAC,UAAUO,UAAY,IACzED,EAAMvB,KAAOuB,EAAMvB,KAAOgB,aAAAC,UAAUQ,QAEnCF,EAAMvB,KAAOgB,aAAAC,UAAUG,KAAO,IAAMG,EAAMvB,KAAOgB,aAAAC,UAAUO,UAAY,IACxED,EAAMvB,KAAOuB,EAAMvB,KAAOgB,aAAAC,UAAUQ,QAEnCF,EAAMvB,KAAOgB,aAAAC,UAAUS,QAAU,IAClCH,EAAMvB,KAAOuB,EAAMvB,KAAOgB,aAAAC,UAAUI,KAAOL,aAAAC,UAAUG,MAEpDG,EAAMvB,KAAOgB,aAAAC,UAAUO,SAAW,IACnCD,EAAMvB,KAAOuB,EAAMvB,KAAOgB,aAAAC,UAAUI,MAGjCE,EAGX,QAAAI,WAA0BhB,EAAkBY,GAKxC,GAHAA,EAAQb,YAAYa,EAAOP,aAAAC,UAAUQ,OACrCd,EAAQD,YAAYC,GAEhBY,EAAMA,MACN,MAAOA,GAAMA,MAAMZ,EAChB,IAAIA,EAAMY,MACb,MAAOZ,GAAMY,MAAMA,EAEnBA,GAAQD,iBAAiBC,EAG7B,IAAIK,GAAKjB,EAAMX,KAAOuB,EAAMvB,IAE5B,IAAI4B,GAAM,EACN,OAAO,CAGX,KAAKjB,EAAMX,KAAOgB,aAAAC,UAAUE,OAAS,EAAG,CACpC,IAAKI,EAAMvB,KAAOgB,aAAAC,UAAUE,QAAU,EAClC,OAAO,CAEP,IAAIS,GAAMZ,aAAAC,UAAUE,MAChB,OAAO,EAKnB,IAAKR,EAAMX,KAAOgB,aAAAC,UAAUY,OAAS,EAAG,CACpC,IAAKN,EAAMvB,KAAOgB,aAAAC,UAAUY,QAAU,EAClC,OAAO,CAEP,IAAID,GAAMZ,aAAAC,UAAUY,MAChB,OAAO,EAKnB,IAAKlB,EAAMX,KAAOgB,aAAAC,UAAUI,MAAQ,EAAG,CACnC,IAAKE,EAAMvB,KAAOgB,aAAAC,UAAUI,OAAS,EACjC,OAAO,CAEP,IAAIO,GAAMZ,aAAAC,UAAUI,KAChB,OAAO,EAKnB,IAAKV,EAAMX,KAAOgB,aAAAC,UAAUG,KAAO,EAAG,CAClC,IAAKG,EAAMvB,KAAOgB,aAAAC,UAAUG,MAAQ,EAChC,OAAO,CAEP,IAAIQ,GAAMZ,aAAAC,UAAUG,IAChB,OAAO,EAKnB,OAAO,EAGX,QAAAU,gBAA+BnB,EAAkBY,GAC7C,GAAIZ,EAAMoB,OAASR,GAASA,EAAMQ,OAC9B,GAAI5C,EAAE6C,SAAST,EAAMQ,OAAQ,CACzB,GAAI5C,EAAE6C,SAASrB,EAAMoB,QAAUpB,EAAMoB,QAAUR,EAAMQ,MACjD,OAAO,CACJ,IAAI5C,EAAE8C,QAAQtB,EAAMoB,QAAUpB,EAAMoB,MAAMtB,QAAQc,EAAMQ,OAAS,EACpE,OAAO,MAER,IAAI5C,EAAE8C,QAAQV,EAAMQ,OAAQ,CAC/B,GAAI5C,EAAE6C,SAASrB,EAAMoB,QAAUR,EAAMQ,MAAMtB,QAAQE,EAAMoB,OAAS,EAC9D,OAAO,CACJ,IAAI5C,EAAE8C,QAAQtB,EAAMoB,SAAW3B,SAASO,EAAMoB,MAAOR,EAAMQ,OAC9D,OAAO,OAGZ,CAAA,GAAIpB,EAAMoB,MACb,OAAO,CACJ,IAAIR,GAASA,EAAMQ,MACtB,OAAO,EAGX,OAAO,EArKX,GAAY5C,GAAC+C,QAAM,UACnBlB,aAAAkB,QAA6D,gBAC7D7C,KAAA6C,QAAuC,KASvBC,SAAArD,MAAKA,MAiBLqD,QAAArC,cAAaA,cAIbqC,QAAAjC,cAAaA,cAkBbiC,QAAAzB,YAAWA,YAgCXyB,QAAAR,UAASA,UA8DTQ,QAAAL,eAAcA","file":"../utils.js","sourcesContent":["\"use strict\";\nconst _ = require('lodash');\nconst TaskConfig_1 = require('./TaskConfig');\nconst fs_1 = require('fs');\n/**\n * filter fileName in directory.\n *\n * @export\n * @param {string} directory\n * @param {((fileName: string) => boolean)} [express]\n * @returns {string[]}\n */\nfunction files(directory, express) {\n    let res = [];\n    express = express || ((fn) => true);\n    _.each(fs_1.readdirSync(directory), fname => {\n        let filePn = directory + '/' + fname;\n        var fst = fs_1.lstatSync(filePn);\n        if (!fst.isDirectory()) {\n            if (express(filePn)) {\n                res.push(filePn);\n            }\n        }\n        else {\n            res = res.concat(files(filePn, express));\n        }\n    });\n    return res;\n}\nexports.files = files;\nfunction taskSourceVal(src, oper) {\n    return _.isFunction(src) ? src(oper) : (src || '');\n}\nexports.taskSourceVal = taskSourceVal;\nfunction taskStringVal(name, oper) {\n    return _.isFunction(name) ? name(oper) : (name || '');\n}\nexports.taskStringVal = taskStringVal;\nfunction contains(arr1, arr2) {\n    return arr2.some(arr2Item => arr1.indexOf(arr2Item) >= 0);\n}\n/**\n * convert old version Operation to new version Operation\n *\n * @export\n * @param {ITaskInfo} tinfo\n * @param {any} [def=Operation.default]\n * @returns\n */\nfunction convertOper(tinfo, def = TaskConfig_1.Operation.default) {\n    tinfo = tinfo || {};\n    if (tinfo.watch) {\n        tinfo.oper = (tinfo.oper || def) | TaskConfig_1.Operation.watch;\n    }\n    if (tinfo.e2e) {\n        tinfo.oper = (tinfo.oper || def) | TaskConfig_1.Operation.e2e;\n    }\n    if (tinfo.test) {\n        tinfo.oper = (tinfo.oper || def) | TaskConfig_1.Operation.test;\n    }\n    tinfo.oper = tinfo.oper || def;\n    return tinfo;\n}\nexports.convertOper = convertOper;\nfunction convertMatchOper(match) {\n    if ((match.oper & TaskConfig_1.Operation.test) > 0 && (match.oper & TaskConfig_1.Operation.release) <= 0) {\n        match.oper = match.oper | TaskConfig_1.Operation.build;\n    }\n    if ((match.oper & TaskConfig_1.Operation.e2e) > 0 && (match.oper & TaskConfig_1.Operation.release) <= 0) {\n        match.oper = match.oper | TaskConfig_1.Operation.build;\n    }\n    if ((match.oper & TaskConfig_1.Operation.deploy) > 0) {\n        match.oper = match.oper | TaskConfig_1.Operation.test | TaskConfig_1.Operation.e2e;\n    }\n    if ((match.oper & TaskConfig_1.Operation.release) > 0) {\n        match.oper = match.oper | TaskConfig_1.Operation.test;\n    }\n    return match;\n}\nfunction matchOper(tinfo, match) {\n    match = convertOper(match, TaskConfig_1.Operation.build);\n    tinfo = convertOper(tinfo);\n    if (match.match) {\n        return match.match(tinfo);\n    }\n    else if (tinfo.match) {\n        return tinfo.match(match);\n    }\n    else {\n        match = convertMatchOper(match);\n    }\n    let eq = tinfo.oper & match.oper;\n    // console.log('eq------->:', eq);\n    if (eq <= 0) {\n        return false;\n    }\n    if ((tinfo.oper & TaskConfig_1.Operation.watch) > 0) {\n        if ((match.oper & TaskConfig_1.Operation.watch) <= 0) {\n            return false;\n        }\n        else {\n            if (eq <= TaskConfig_1.Operation.watch) {\n                return false;\n            }\n        }\n    }\n    if ((tinfo.oper & TaskConfig_1.Operation.serve) > 0) {\n        if ((match.oper & TaskConfig_1.Operation.serve) <= 0) {\n            return false;\n        }\n        else {\n            if (eq <= TaskConfig_1.Operation.serve) {\n                return false;\n            }\n        }\n    }\n    if ((tinfo.oper & TaskConfig_1.Operation.test) > 0) {\n        if ((match.oper & TaskConfig_1.Operation.test) <= 0) {\n            return false;\n        }\n        else {\n            if (eq <= TaskConfig_1.Operation.test) {\n                return false;\n            }\n        }\n    }\n    if ((tinfo.oper & TaskConfig_1.Operation.e2e) > 0) {\n        if ((match.oper & TaskConfig_1.Operation.e2e) <= 0) {\n            return false;\n        }\n        else {\n            if (eq <= TaskConfig_1.Operation.e2e) {\n                return false;\n            }\n        }\n    }\n    return true;\n}\nexports.matchOper = matchOper;\nfunction matchTaskGroup(tinfo, match) {\n    if (tinfo.group && match && match.group) {\n        if (_.isString(match.group)) {\n            if (_.isString(tinfo.group) && tinfo.group !== match.group) {\n                return false;\n            }\n            else if (_.isArray(tinfo.group) && tinfo.group.indexOf(match.group) < 0) {\n                return false;\n            }\n        }\n        else if (_.isArray(match.group)) {\n            if (_.isString(tinfo.group) && match.group.indexOf(tinfo.group) < 0) {\n                return false;\n            }\n            else if (_.isArray(tinfo.group) && !contains(tinfo.group, match.group)) {\n                return false;\n            }\n        }\n    }\n    else if (tinfo.group) {\n        return false;\n    }\n    else if (match && match.group) {\n        return false;\n    }\n    return true;\n}\nexports.matchTaskGroup = matchTaskGroup;\n","import * as _ from 'lodash';\r\nimport { TaskSource, TaskString, Operation, ITaskInfo } from './TaskConfig';\r\nimport { readdirSync, lstatSync } from 'fs';\r\n/**\r\n * filter fileName in directory.\r\n * \r\n * @export\r\n * @param {string} directory\r\n * @param {((fileName: string) => boolean)} [express]\r\n * @returns {string[]}\r\n */\r\nexport function files(directory: string, express?: ((fileName: string) => boolean)): string[] {\r\n    let res: string[] = [];\r\n    express = express || ((fn) => true);\r\n    _.each(readdirSync(directory), fname => {\r\n        let filePn = directory + '/' + fname;\r\n        var fst = lstatSync(filePn);\r\n        if (!fst.isDirectory()) {\r\n            if (express(filePn)) {\r\n                res.push(filePn)\r\n            }\r\n        } else {\r\n            res = res.concat(files(filePn, express))\r\n        }\r\n    });\r\n    return res;\r\n}\r\n\r\nexport function taskSourceVal(src: TaskSource, oper?: Operation) {\r\n    return _.isFunction(src) ? src(oper) : (src || '');\r\n}\r\n\r\nexport function taskStringVal(name: TaskString, oper?: Operation) {\r\n    return _.isFunction(name) ? name(oper) : (name || '');\r\n}\r\n\r\n\r\nfunction contains(arr1: string[], arr2: string[]) {\r\n    return arr2.some(arr2Item => arr1.indexOf(arr2Item) >= 0);\r\n}\r\n\r\n\r\n/**\r\n * convert old version Operation to new version Operation\r\n * \r\n * @export\r\n * @param {ITaskInfo} tinfo\r\n * @param {any} [def=Operation.default]\r\n * @returns\r\n */\r\nexport function convertOper(tinfo: ITaskInfo, def = Operation.default) {\r\n    tinfo = tinfo || {};\r\n    if (tinfo.watch) {\r\n        tinfo.oper = (tinfo.oper || def) | Operation.watch;\r\n    }\r\n    if (tinfo.e2e) {\r\n        tinfo.oper = (tinfo.oper || def) | Operation.e2e;\r\n    }\r\n    if (tinfo.test) {\r\n        tinfo.oper = (tinfo.oper || def) | Operation.test;\r\n    }\r\n\r\n    tinfo.oper = tinfo.oper || def;\r\n    return tinfo;\r\n}\r\nfunction convertMatchOper(match: ITaskInfo) {\r\n    if ((match.oper & Operation.test) > 0 && (match.oper & Operation.release) <= 0) {\r\n        match.oper = match.oper | Operation.build;\r\n    }\r\n    if ((match.oper & Operation.e2e) > 0 && (match.oper & Operation.release) <= 0) {\r\n        match.oper = match.oper | Operation.build;\r\n    }\r\n    if ((match.oper & Operation.deploy) > 0) {\r\n        match.oper = match.oper | Operation.test | Operation.e2e;\r\n    }\r\n    if ((match.oper & Operation.release) > 0) {\r\n        match.oper = match.oper | Operation.test;\r\n    }\r\n\r\n    return match;\r\n}\r\n\r\nexport function matchOper(tinfo: ITaskInfo, match: ITaskInfo) {\r\n\r\n    match = convertOper(match, Operation.build);\r\n    tinfo = convertOper(tinfo);\r\n\r\n    if (match.match) {\r\n        return match.match(tinfo);\r\n    } else if (tinfo.match) {\r\n        return tinfo.match(match);\r\n    } else {\r\n        match = convertMatchOper(match);\r\n    }\r\n\r\n    let eq = tinfo.oper & match.oper;\r\n    // console.log('eq------->:', eq);\r\n    if (eq <= 0) {\r\n        return false;\r\n    }\r\n\r\n    if ((tinfo.oper & Operation.watch) > 0) {\r\n        if ((match.oper & Operation.watch) <= 0) {\r\n            return false;\r\n        } else {\r\n            if (eq <= Operation.watch) {\r\n                return false;\r\n            }\r\n        }\r\n    }\r\n\r\n    if ((tinfo.oper & Operation.serve) > 0) {\r\n        if ((match.oper & Operation.serve) <= 0) {\r\n            return false;\r\n        } else {\r\n            if (eq <= Operation.serve) {\r\n                return false;\r\n            }\r\n        }\r\n    }\r\n\r\n    if ((tinfo.oper & Operation.test) > 0) {\r\n        if ((match.oper & Operation.test) <= 0) {\r\n            return false;\r\n        } else {\r\n            if (eq <= Operation.test) {\r\n                return false;\r\n            }\r\n        }\r\n    }\r\n\r\n    if ((tinfo.oper & Operation.e2e) > 0) {\r\n        if ((match.oper & Operation.e2e) <= 0) {\r\n            return false;\r\n        } else {\r\n            if (eq <= Operation.e2e) {\r\n                return false;\r\n            }\r\n        }\r\n    }\r\n\r\n    return true;\r\n}\r\n\r\nexport function matchTaskGroup(tinfo: ITaskInfo, match: ITaskInfo): boolean {\r\n    if (tinfo.group && match && match.group) {\r\n        if (_.isString(match.group)) {\r\n            if (_.isString(tinfo.group) && tinfo.group !== match.group) {\r\n                return false;\r\n            } else if (_.isArray(tinfo.group) && tinfo.group.indexOf(match.group) < 0) {\r\n                return false;\r\n            }\r\n        } else if (_.isArray(match.group)) {\r\n            if (_.isString(tinfo.group) && match.group.indexOf(tinfo.group) < 0) {\r\n                return false;\r\n            } else if (_.isArray(tinfo.group) && !contains(tinfo.group, match.group)) {\r\n                return false;\r\n            }\r\n        }\r\n    } else if (tinfo.group) {\r\n        return false;\r\n    } else if (match && match.group) {\r\n        return false;\r\n    }\r\n\r\n    return true;\r\n}\r\n"]}