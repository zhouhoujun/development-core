"use strict";function toSequence(e,r,n){var o=[],t=r.length;return t<1?o:(r=_.orderBy(r,function(e){return _.isArray(e)?t:_.isNumber(e.decorator.order)?e.decorator.order:t}),_.each(r,function(r){if((!r.decorator.watch||n.env.watch)&&(!r.decorator.oper||r.decorator.oper&&(r.decorator.oper&n.oper)>0)){var t=r.setup(n,e);t&&o.push(t)}}),o)}function addToSequence(e,r){if(!r)return e;if(r.name){if(_.isNumber(r.order)&&r.order>=0&&r.order<e.length)return e.splice(r.order,0,r.name),e;e.push(r.name)}return e}function runSequence(e,r){var n=Promise.resolve();return r&&r.length>0&&_.each(r,function(r){n=n.then(function(){var n=null,o=null;return new Promise(function(t,u){var c={};_.each(_.isArray(r)?r:[r],function(e){c[e]=!1}),n=function(e){process.exit(e),console.error(chalk.red(e)),u(e)},o=function(e){c[e.task]=!0,_.some(_.values(c),function(e){return!e})||t()},e.on("task_stop",o).on("task_err",n),e.start(r)}).then(function(){e.removeListener&&(e.removeListener("task_stop",o),e.removeListener("task_err",n))}).catch(function(r){e.removeListener&&(e.removeListener("task_stop",o),e.removeListener("task_err",n))})})}),n.catch(function(e){console.error(chalk.red(e))})}function runTaskSequence(e,r,n){var o=toSequence(e,r,n);return runSequence(e,o)}var _=require("lodash"),chalk=require("chalk");exports.toSequence=toSequence,exports.addToSequence=addToSequence,exports.runSequence=runSequence,exports.runTaskSequence=runTaskSequence;
//# sourceMappingURL=sourcemaps/taskSequence.js.map
