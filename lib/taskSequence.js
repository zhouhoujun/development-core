"use strict";function toSequence(e,r,n){var t=[],o=r.length;return o<1?t:(r=_.orderBy(r,function(e){if(_.isArray(e))return o;var r=e.getInfo();return _.isNumber(r.order)?r.order:o}),_.each(r,function(r){var o=r.getInfo();if((!o.watch||n.env.watch)&&(!o.oper||o.oper&&(o.oper&n.oper)>0)){var u=r.setup(n,e);u&&t.push(u)}}),t)}function addToSequence(e,r){if(!r)return e;if(r.taskName){if(_.isNumber(r.order)&&r.order>=0&&r.order<e.length)return e.splice(r.order,0,r.taskName),e;e.push(r.taskName)}return e}function runSequence(e,r){console.log("run tasks : ",chalk.cyan(r));var n=new Promise(function(n,t){var o=null;return r&&r.length>0?_.each(r,function(r){o=o?o.then(function(){return startTask(e,r)}):startTask(e,r)}):o=Promise.resolve(),o.then(n).catch(t)});return n.catch(function(e){console.error(chalk.red(e)),process.exit(0)})}function startTask(e,r){var n=null,t=null;return new Promise(function(o,u){var s={};_.each(_.isArray(r)?r:[r],function(e){s[e]=!1}),n=function(e){process.exit(e),console.error(chalk.red(e)),u(e)},t=function(e){s[e.task]=!0,_.some(_.values(s),function(e){return!e})||o()},e.on("task_stop",t).on("task_err",n),e.start(r)}).then(function(){e.removeListener&&(e.removeListener("task_stop",t),e.removeListener("task_err",n))},function(r){e.removeListener&&(e.removeListener("task_stop",t),e.removeListener("task_err",n))})}function runTaskSequence(e,r,n){return Promise.resolve(r).then(function(r){var t=toSequence(e,r,n);return runSequence(e,t)})}var _=require("lodash"),chalk=require("chalk");exports.toSequence=toSequence,exports.addToSequence=addToSequence,exports.runSequence=runSequence,exports.runTaskSequence=runTaskSequence;
//# sourceMappingURL=sourcemaps/taskSequence.js.map
