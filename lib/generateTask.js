"use strict";function generateTask(e,r,t){var n=[];return _.each(_.isArray(e)?e:[e],function(e){if(!(e.oper&&(e.oper&r)<=0))if(e.watch){if(!t.watch)return;n.push(createWatchTask(e))}else _.isFunction(e.task)?n.push(createTask(e)):n.push(createPipesTask(e))}),n}function createTask(e){return function(r,t){var n=t.subTaskName(utils_1.taskStringVal(e.name,t.oper));return console.log("register custom dynamic task:",chalk.cyan(n)),r.task(n,function(){return e.task(t,e,r)}),_.isNumber(e.order)?{name:n,order:e.order}:n}}function createWatchTask(e){return function(r,t){var n=_.isFunction(e.watch)?e.watch(t):e.watch;_.isFunction(_.last(n))||n.push(function(r){e.watchChanged&&e.watchChanged(r,t)}),n=_.map(n,function(e){return _.isString(e)?t.subTaskName(e):e});var a=t.subTaskName(utils_1.taskStringVal(e.name,t.oper));return console.log("register watch  dynamic task:",chalk.cyan(a)),r.task(a,function(){console.log("watch, src:",chalk.cyan.call(chalk,t.option.src)),r.watch(utils_1.taskSourceVal(t.option.src,t.oper),n)}),_.isNumber(e.order)?{name:a,order:e.order}:a}}function createPipesTask(e){return function(r,t){var n=t.subTaskName(utils_1.taskStringVal(e.name,t.oper));return console.log("register pipes  dynamic task:",chalk.cyan(n)),r.task(n,function(){var n=Promise.resolve(r.src(utils_1.taskSourceVal(e.src,t.oper)||utils_1.taskSourceVal(t.option.src,t.oper)));if(e.pipes){var a=_.isFunction(e.pipes)?e.pipes(t,e):e.pipes;_.each(a,function(a){n=n.then(function(n){return Promise.resolve(_.isFunction(a)?a(t,e,r):a).then(function(e){return n.pipe(e)})})})}else e.pipe&&(n=n.then(function(r){return e.pipe(r,t,e)}));return n.then(function(n){if(e.output){var a=_.isFunction(e.output)?e.output(t,e):e.output;return Promise.all(_.map(a,function(a){return new Promise(function(s,o){Promise.resolve(_.isFunction(a)?a(n,t,e,r):a).then(function(e){n.pipe(e).once("end",s).once("error",o)})})}))}return new Promise(function(a,s){n.pipe(r.dest(t.getDist(e))).once("end",a).once("error",s)})}),n.catch(function(e){console.log(chalk.red(e))})}),_.isNumber(e.order)?{name:n,order:e.order}:n}}var _=require("lodash"),chalk=require("chalk"),utils_1=require("./utils");exports.generateTask=generateTask;
//# sourceMappingURL=sourcemaps/generateTask.js.map
